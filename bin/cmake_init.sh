#!/bin/bash
#set -x
#     Copyright (C) 2015 Thales Communication & Security
#       - All Rights Reserved
#     coded by Hugues Balp

exename=$1
src_dir=$2

function cmakelists_gen ()
{
  exename=$1
  shift
  src_dir=$@
  cmakelists_filename="CMakeLists.txt"

  ici=`pwd`
  #echo "ici: ${ici}"
  cd $src_dir
  #echo "src_dir: ${src_dir}"
  src_files=`ls *.c*`
  cd $ici

  cat > ${cmakelists_filename} <<EOF
# File generated by Callers's cmake_init.sh
cmake_minimum_required(VERSION 2.8)

# generate list of source files with related compilation command
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# add debug symbols
set(CMAKE_BUILD_TYPE Debug)

# add path to header files
include_directories(".")

# define build target
add_executable(${exename}
${src_files})

# add path to external libraries
# target_link_libraries(${exename} /path/to/lib*.so)
EOF
}

cmakelists_gen ${exename} ${src_dir}

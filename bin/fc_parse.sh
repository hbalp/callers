#!/bin/bash
#set -x
#     Copyright (C) 2015 Thales Communication & Security
#       - All Rights Reserved
#     coded by Hugues Balp
#     This file generates a script for parsing with frama-c some preprocessed src files

function fc_parse ()
{
  exename=$1
  curdir=${PWD}
  preproc_files=`find ${curdir} -type f -name "*.i" | awk '{ print $1 " \\\" }'`
  fc_parse_prepro_files="fc_parse_preproc_files.gen.sh"
  fc_parsed_data="${exename}.gen.fc.parsed.sav"
  fc_parse_args="-save ${fc_parsed_data}"

  cat > ${fc_parse_prepro_files} <<EOF
#!/bin/bash
# Generated by fc_parse.sh

frama-c \\
${preproc_files}
${fc_parse_args}
EOF
}
